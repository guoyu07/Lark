var __extends=this.__extends||function(t,i){function e(){this.constructor=t}for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o]);e.prototype=i.prototype,t.prototype=new e},__define=this.__define||function(t,i,e,o){Object.defineProperty(t,i,{configurable:!0,enumerable:!0,get:e,set:o})},lark;!function(t){var i;!function(i){var e=function(e){function o(i){var o=this;e.call(this),this.audios=[],this.loaded=!1,this.closed=!1,this.onAudioLoaded=function(){o.loaded=!0,o.originAudio.removeEventListener("canplaythrough",o.onAudioLoaded),o.emitWith(t.Event.COMPLETE)},this.url=i}__extends(o,e);var n=o;return p=n.prototype,p.load=function(t){var i=this;t=t||this.url;var e=new Audio(t);e.addEventListener("canplaythrough",this.onAudioLoaded),e.addEventListener("error",function(){return i.onAudioError()}),e.load(),this.originAudio=e,this.audios.push(e)},p.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1);var o=this.audios.pop();void 0==o?(o=this.originAudio.cloneNode(),o.addEventListener("canplaythrough",function(){return o.currentTime=t})):o.currentTime=t,o.loop=!!e;var n=new i.HtmlSoundChannel(o);return n.$sound=this,n.$loop=e,n.$startTime=t,o.play(),n},p.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),this.audios&&(this.audios.length=0),this.closed=!0},p.$recycle=function(t){this.closed||this.audios.push(t)},p.onAudioError=function(){this.emitWith(t.Event.IO_ERROR)},o}(t.EventEmitter);i.HtmlSound=e,t.registerClass(e,"lark.web.HtmlSound",["lark.Sound","lark.IEventEmitter"]),t.Sound=e}(i=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var i;!function(i){var e=function(i){function e(t){var e=this;i.call(this),this.$loop=!1,this.$startTime=0,this.audio=null,this.onPlayEnd=function(){return 0==e.$loop?void e.stop():(e.audio.load(),e.audio.currentTime=e.$startTime,void e.audio.play())},t.addEventListener("ended",this.onPlayEnd),this.audio=t}__extends(e,i);var o=__define,n=e;return p=n.prototype,p.stop=function(){if(this.audio){var i=this.audio;i.pause(),i.removeEventListener("ended",this.onPlayEnd),i.$channel=null,this.audio=null,this.emitWith(t.Event.ENDED),this.$sound.$recycle(i),this.$sound=null}},o(p,"volume",function(){return this.audio?this.audio.volume:1},function(t){this.audio&&(this.audio.volume=t)}),o(p,"position",function(){return this.audio?this.audio.currentTime:0},void 0),e}(t.EventEmitter);i.HtmlSoundChannel=e,t.registerClass(e,"lark.web.HtmlSoundChannel",["lark.SoundChannel","lark.IEventEmitter"])}(i=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var i;!function(i){var e=function(i){function e(e){var o=this;i.call(this),this.loaded=!1,this.closed=!1,this.heightSet=0/0,this.widthSet=0/0,this._fullscreen=!0,this.onVideoLoaded=function(){o.video.removeEventListener("canplay",o.onVideoLoaded);o.width,o.height;o.loaded=!0,o.video.pause(),o.posterData&&(o.posterData.width=o.video.videoWidth,o.posterData.height=o.video.videoHeight),o.$invalidateContentBounds(),o.width=isNaN(o.widthSet)?o.video.videoWidth:o.widthSet,o.height=isNaN(o.heightSet)?o.video.videoHeight:o.heightSet,o.emitWith(t.Event.COMPLETE)},this.$renderRegion=new t.sys.Region,this.src=e,this.once(t.Event.ADDED_TO_STAGE,this.loadPoster,this)}__extends(e,i);var o=__define,n=e;return p=n.prototype,p.load=function(t){var i=this;t=t||this.src;var e=document.createElement("video");e.src=t,e.setAttribute("webkit-playsinline","webkit-playsinline"),e.addEventListener("canplay",this.onVideoLoaded),e.addEventListener("error",function(){return i.onVideoError()}),e.addEventListener("ended",function(){return i.onVideoEnded()}),e.load(),e.play(),setTimeout(function(){return e.pause()},16),this.video=e},p.play=function(i,e){var o=this;if(void 0===e&&(e=!1),0==this.loaded)return this.load(),void this.once(t.Event.COMPLETE,function(){return o.play(i,e)},this);var n=this.video;void 0!=i&&(n.currentTime=+i||0),n.loop=!!e,n.play(),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.height="0",n.style.width="0",document.body.appendChild(n);var s=!1;this._fullscreen&&(s=this.goFullscreen()),0==s&&(n.setAttribute("webkit-playsinline","webkit-playsinline"),t.startTick(this.markDirty,this))},p.goFullscreen=function(){var i=this,e=this.video;if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.webkitRequestFullScreen)e.webkitRequestFullScreen();else if(e.msRequestFullscreen)e.msRequestFullscreen();else{if(!e.requestFullscreen)return!1;e.requestFullscreen()}return e.removeAttribute("webkit-playsinline"),e.onwebkitfullscreenchange=function(){var t=!!e.webkitDisplayingFullscreen;t||i.pause()},e.onwebkitfullscreenerror=function(){t.$error(3003)},!0},p.close=function(){this.pause(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&(this.video.remove&&this.video.remove(),this.video=null),this.closed=!0,this.loaded=!1},p.pause=function(){this.video&&(this.video.pause(),this.onVideoEnded()),t.stopTick(this.markDirty,this)},o(p,"volume",function(){return this.video?this.video.volume:1},function(t){this.video&&(this.video.volume=t)}),o(p,"position",function(){return this.video?this.video.currentTime:0},function(t){this.video&&(this.video.currentTime=t)}),o(p,"fullscreen",function(){return this._fullscreen},function(t){this._fullscreen=!!t,this.video&&0==this.video.paused&&this.goFullscreen()}),o(p,"bitmapData",function(){return this.video&&this.loaded?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=t.web.toBitmapData(this.video)),this._bitmapData):null},void 0),p.loadPoster=function(){var i=this,e=this.poster;if(e){var o=new t.ImageLoader;o.once(t.Event.COMPLETE,function(){i.posterData=o.data,i.video?(i.posterData.width=i.video.videoWidth,i.posterData.height=i.video.videoHeight):(i.posterData.width=isNaN(i.widthSet)?i.posterData.width:i.widthSet,i.posterData.height=isNaN(i.heightSet)?i.posterData.height:i.heightSet),i.$invalidateContentBounds()},this),o.load(e)}},p.onVideoEnded=function(){this.emitWith(t.Event.ENDED),this.$invalidateContentBounds()},p.onVideoError=function(){this.emitWith(t.Event.IO_ERROR)},p.$measureContentBounds=function(t){var i=this.bitmapData,e=this.posterData;i?t.setTo(0,0,i.width,i.height):e?t.setTo(0,0,e.width,e.height):t.setEmpty()},p.$render=function(t){var i=this.bitmapData,e=this.posterData;(!i||this.video&&this.video.paused)&&e&&t.drawImage(e,0,0,e.width,e.height),i&&(t.imageSmoothingEnabled=!0,t.drawImage(i,0,0,i.width,i.height))},p.markDirty=function(){return this.$invalidate(),!0},p.$setHeight=function(t){i.prototype.$setHeight.call(this,t),this.heightSet=+t||0},p.$setWidth=function(t){i.prototype.$setWidth.call(this,t),this.widthSet=+t||0},e}(t.DisplayObject);i.WebVideo=e,t.registerClass(e,"lark.web.WebVideo",["lark.Video"]),t.Video=e}(i=t.web||(t.web={}))}(lark||(lark={}));