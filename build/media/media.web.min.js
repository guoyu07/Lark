var __extends=this.__extends||function(i,t){function e(){this.constructor=i}for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);e.prototype=t.prototype,i.prototype=new e},__define=this.__define||function(i,t,e,o){Object.defineProperty(i,t,{configurable:!0,enumerable:!0,get:e,set:o})},lark;!function(i){var t;!function(t){var e=function(e){function o(t){var o=this;e.call(this),this.audios=[],this.loaded=!1,this.closed=!1,this.onAudioLoaded=function(){o.loaded=!0,o.originAudio.removeEventListener("canplaythrough",o.onAudioLoaded),o.emitWith(i.Event.COMPLETE)},this.url=t}__extends(o,e);var n=o;return p=n.prototype,p.load=function(i){var t=this;i=i||this.url;var e=new Audio(i);e.addEventListener("canplaythrough",this.onAudioLoaded),e.addEventListener("error",function(){return t.onAudioError()}),e.load(),this.originAudio=e,this.audios.push(e)},p.play=function(i,e){void 0===i&&(i=0),void 0===e&&(e=!1);var o=this.audios.pop();void 0==o?(o=this.originAudio.cloneNode(),o.addEventListener("canplaythrough",function(){return o.currentTime=i})):o.currentTime=i,o.loop=!!e;var n=new t.HtmlSoundChannel(o);return n.$sound=this,n.$loop=e,n.$startTime=i,o.play(),n},p.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),this.audios&&(this.audios.length=0),this.closed=!0},p.$recycle=function(i){this.closed||this.audios.push(i)},p.onAudioError=function(){this.emitWith(i.Event.IO_ERROR)},o}(i.EventEmitter);t.HtmlSound=e,i.registerClass(e,"lark.web.HtmlSound",["lark.Sound","lark.IEventEmitter"]),i.Sound=e}(t=i.web||(i.web={}))}(lark||(lark={}));var lark;!function(i){var t;!function(t){var e=function(t){function e(i){var e=this;t.call(this),this.$loop=!1,this.$startTime=0,this.audio=null,this.onPlayEnd=function(){return 0==e.$loop?void e.stop():(e.audio.load(),e.audio.currentTime=e.$startTime,void e.audio.play())},i.addEventListener("ended",this.onPlayEnd),this.audio=i}__extends(e,t);var o=__define,n=e;return p=n.prototype,p.stop=function(){if(this.audio){var t=this.audio;t.pause(),t.removeEventListener("ended",this.onPlayEnd),t.$channel=null,this.audio=null,this.emitWith(i.Event.ENDED),this.$sound.$recycle(t),this.$sound=null}},o(p,"volume",function(){return this.audio?this.audio.volume:1},function(i){this.audio&&(this.audio.volume=i)}),o(p,"position",function(){return this.audio?this.audio.currentTime:0},void 0),e}(i.EventEmitter);t.HtmlSoundChannel=e,i.registerClass(e,"lark.web.HtmlSoundChannel",["lark.SoundChannel","lark.IEventEmitter"])}(t=i.web||(i.web={}))}(lark||(lark={}));var lark;!function(i){var t;!function(t){var e=function(t){function e(i){t.call(this),this.loaded=!1,this.closed=!1,this.url=i}__extends(e,t);var o=__define,n=e;return p=n.prototype,p.load=function(i){var t=this;i=i||this.url;var e=document.createElement("video");e.src=i,e.addEventListener("canplay",function(){return t.onVideoLoaded()}),e.addEventListener("error",function(){return t.onVideoError()}),e.addEventListener("ended",function(){return t.onVideoEnded()}),e.load(),this.video=e},p.play=function(i,t){void 0===i&&(i=0),void 0===t&&(t=!1);var e=this.video;e.currentTime=i,e.loop=!!t,e.play()},p.close=function(){this.stop(),0==this.loaded&&this.video&&(this.video.src=""),this.video&&(this.video=null),this.closed=!0,this.loaded=!1},p.stop=function(){this.video&&(this.video.pause(),this.onVideoEnded())},o(p,"volume",function(){return this.video?this.video.volume:1},function(i){this.video&&(this.video.volume=i)}),o(p,"position",function(){return this.video?this.video.currentTime:0},function(i){this.video&&(this.video.currentTime=i)}),o(p,"bitmapData",function(){return this.video?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=i.web.toBitmapData(this.video)),this._bitmapData):null},void 0),p.onVideoLoaded=function(){this.loaded=!0,this.emitWith(i.Event.COMPLETE)},p.onVideoEnded=function(){this.emitWith(i.Event.ENDED)},p.onVideoError=function(){this.emitWith(i.Event.IO_ERROR)},e}(i.EventEmitter);t.WebVideo=e,i.registerClass(e,"lark.web.WebVideo",["lark.Video","lark.IEventEmitter"]),i.Video=e}(t=i.web||(i.web={}))}(lark||(lark={}));