var __extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__define=this.__define||function(t,e,n,i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:n,set:i})},lark;!function(t){var e;!function(e){var n=window.URL||window.webkitURL,i=n&&"iOS"==t.Capabilities.os,r=function(r){function a(){var n=this;r.apply(this,arguments),this.data=null,this.crossOrigin=null,this.currentImage=null,this.request=null,this.onImageComplete=function(i){var r=n.getImage(i);r&&(n.data=e.toBitmapData(r),n.emitWith(t.Event.COMPLETE))},this.onLoadError=function(e){var i=n.getImage(e);i&&n.emitWith(t.Event.IO_ERROR)}}__extends(a,r);var o=a;return p=o.prototype,p.load=function(e){if(i&&0!=e.indexOf("data:")){var n=this.request;n||(n=this.request=new t.web.WebHttpRequest,n.on(t.Event.COMPLETE,this.onBlobLoaded,this),n.on(t.Event.IO_ERROR,this.onBlobError,this),n.responseType="blob"),n.open(e),n.send()}else this.loadImage(e)},p.onBlobLoaded=function(){var t=this.request.response;this.loadImage(n.createObjectURL(t))},p.onBlobError=function(){this.emitWith(t.Event.IO_ERROR)},p.loadImage=function(t){var e=new Image;this.data=null,this.currentImage=e,this.crossOrigin&&(e.crossOrigin=this.crossOrigin),e.onload=this.onImageComplete,e.onerror=this.onLoadError,e.src=t},p.getImage=function(t){var e=t.target;return i&&n.revokeObjectURL(e.src),e.onerror=null,e.onload=null,this.currentImage!==e?null:(this.currentImage=null,e)},a}(t.EventEmitter);e.WebImageLoader=r,t.registerClass(r,20),t.ImageLoader=r}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(){var n=this;e.call(this),this._url="",this.onReadyStateChange=function(){var e=n._xhr;4==e.readyState&&n.emitWith(e.status>=400||0==e.status?t.Event.IO_ERROR:t.Event.COMPLETE)},this.updateProgress=function(e){e.lengthComputable&&t.ProgressEvent.emitProgressEvent(n,t.ProgressEvent.PROGRESS,e.loaded,e.total)},this._xhr=new XMLHttpRequest,this._xhr.onreadystatechange=this.onReadyStateChange,this._xhr.onprogress=this.updateProgress}__extends(n,e);var i=__define,r=n;return p=r.prototype,i(p,"response",function(){return this._xhr.response?this._xhr.response:this._xhr.responseXML?this._xhr.responseXML:this._xhr.responseText?this._xhr.responseText:null},void 0),i(p,"responseType",function(){return this._xhr.responseType},function(t){this._xhr.responseType=t}),i(p,"withCredentials",function(){return this._xhr.withCredentials},function(t){this._xhr.withCredentials=!!t}),p.open=function(t,e){void 0===e&&(e="GET"),this._url=t,this._xhr.open(e,t,!0)},p.send=function(t){this._xhr.send(t)},p.abort=function(){this._xhr.abort()},p.getAllResponseHeaders=function(){var t=this._xhr.getAllResponseHeaders();return t?t:""},p.setRequestHeader=function(t,e){this._xhr.setRequestHeader(t,e)},p.getResponseHeader=function(t){var e=this._xhr.getResponseHeader(t);return e?e:""},n}(t.EventEmitter);e.WebHttpRequest=n,t.registerClass(n,19),t.HttpRequest=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(){function e(){}var n=e;return p=n.prototype,e.detect=function(){var n=t.Capabilities,i=navigator.userAgent.toLowerCase();n.$isMobile=-1!=i.indexOf("mobile")||-1!=i.indexOf("android"),n.$isMobile?i.indexOf("windows")<0&&(-1!=i.indexOf("iphone")||-1!=i.indexOf("ipad")||-1!=i.indexOf("ipod"))?n.$os="iOS":-1!=i.indexOf("android")&&-1!=i.indexOf("linux")?n.$os="Android":-1!=i.indexOf("windows")&&(n.$os="Windows Phone"):-1!=i.indexOf("windows nt")?n.$os="Windows PC":-1!=i.indexOf("mac os")&&(n.$os="Mac OS");var r=e.checkHtml5Support();n.$hasGeolocation=r.geo,n.$hasMotion=r.m,n.$hasOrientation=r.ortt;var a=(navigator.language||navigator.browserLanguage).toLowerCase(),o=a.split("-");o.length>1&&(o[1]=o[1].toUpperCase()),n.$language=o.join("-")},e.checkHtml5Support=function(){var t=("webkitAudioContext"in window||"AudioContext"in window,"geolocation"in navigator),e="DeviceOrientationEvent"in window,n="DeviceMotionEvent"in window;return{geo:t,ortt:e,m:n}},e}();e.WebCapability=n,n.detect()}(e=t.web||(t.web={}))}(lark||(lark={})),void 0==window.HTMLVideoElement&&(window.HTMLVideoElement=HTMLDivElement);var lark;!function(t){var e;!function(e){function n(e){return e.hashCode=e.$hashCode=t.$hashCount++,e}t.registerClass(HTMLImageElement,7),t.registerClass(HTMLCanvasElement,7),t.registerClass(HTMLVideoElement,7),e.toBitmapData=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(t){for(var e=s.parseFromString(t,"text/xml"),n=e.childNodes.length,r=0;n>r;r++){var a=e.childNodes[r];if(1===a.nodeType)return i(a,null)}return null}function i(t,e){if("parsererror"==t.localName)throw new Error(t.textContent);for(var n=new a(t.localName,e,t.prefix,t.namespaceURI,t.nodeName),r=t.attributes,s=n.attributes,l=r.length,u=0;l>u;u++){var c=r[u],h=c.name;0!==h.indexOf("xmlns:")&&(s[h]=c.value)}var p=t.childNodes;l=p.length;var d=n.children;for(u=0;l>u;u++){var v=p[u],f=v.nodeType,g=null;if(1===f)g=i(v,n);else if(3===f){var m=v.textContent.trim();m&&(g=new o(m,n))}g&&d.push(g)}return n}var r=function(){function t(t,e){this.nodeType=t,this.parent=e}var e=t;return p=e.prototype,t}();e.XMLNode=r;var a=function(t){function e(e,n,i,r,a){t.call(this,1,n),this.attributes={},this.children=[],this.localName=e,this.prefix=i,this.namespace=r,this.name=a}__extends(e,t);var n=e;return p=n.prototype,e}(r);e.XML=a;var o=function(t){function e(e,n){t.call(this,3,n),this.text=e}__extends(e,t);var n=e;return p=n.prototype,e}(r);e.XMLText=o;var s=new DOMParser;t.XML={parse:n}}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=[],i=-1!=navigator.userAgent.indexOf("QQBrowser"),r=function(){function r(){t.sys.sharedRenderContext=this.create().renderContext;for(var e=0;3>e;e++)n.push(this.create())}var a=r;return p=a.prototype,p.create=function(e){var r=e||n.length>3?n.pop():null;if(!r){var a=document.createElement("canvas");if(i&&!this.testCanvasValid(a))return t.warn("failed to create canvas!"),null;r=this.createSurface(a)}return r},p.release=function(t){t&&(t.width=t.height=1,n.push(t))},p.testCanvasValid=function(t){t.height=1,t.width=1;var e=t.toDataURL("image/png");return"data:,"==e?!1:!0},p.createSurface=function(t){var n=t.getContext("2d");t.renderContext=n,n.surface=t,e.toBitmapData(t);var i=n.drawImage;if(n.drawImage=function(t){t&&0!==t.width&&0!==t.height&&i.apply(n,arguments)},void 0===n.imageSmoothingEnabled){for(var r=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],a=r.length-1;a>=0;a--){var o=r[a];if(void 0!==n[o])break}try{Object.defineProperty(n,"imageSmoothingEnabled",{get:function(){return this[o]},set:function(t){this[o]=t}})}catch(s){n.imageSmoothingEnabled=n[o]}}return t},r}();e.CanvasFactory=r}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(t,n,i,r,a){e.call(this),this.container=t,this.canvas=n,this.scaleMode=i,this.contentWidth=r,this.contentHeight=a,this.attachCanvas(t,n)}__extends(n,e);var i=n;return p=i.prototype,p.attachCanvas=function(t,e){var n=e.style;n.cursor="default",n.position="absolute",n.top="0",n.bottom="0",n.left="0",n.right="0",t.appendChild(e),n=t.style,n.overflow="hidden",n.position="relative"},p.updateScreenSize=function(e,n,i){var r=this.canvas;if(!r.userTyping){var a=this.container.getBoundingClientRect(),o=t.sys.screenAdapter.calculateStageSize(this.scaleMode,a.width,a.height,this.contentWidth,this.contentHeight),s=o.stageWidth,l=o.stageHeight,u=o.displayWidth,c=o.displayHeight;r.width!==s&&(r.width=s),r.height!==l&&(r.height=l),r.style.width=u+"px",r.style.height=c+"px",r.style.top=(a.height-c)/2+"px",r.style.left=(a.width-u)/2+"px",e.updateStageSize(s,l);var h=u/s,p=c/l;n.updateScaleMode(h,p),i.updateScaleMode(h,p,(a.width-u)/2,(a.height-c)/2)}},n}(t.LarkObject);e.WebScreen=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(t,n){var i=this;e.call(this),this.onTouchBegin=function(t){var e=i.getLocation(t);i.touch.onTouchBegin(e.x,e.y,t.identifier)},this.onTouchMove=function(t){var e=i.getLocation(t);i.touch.onTouchMove(e.x,e.y,t.identifier)},this.onTouchEnd=function(t){var e=i.getLocation(t);i.touch.onTouchEnd(e.x,e.y,t.identifier)},this.scaleX=1,this.scaleY=1,this.canvas=n,this.touch=t,this.addListeners()}__extends(n,e);var i=n;return p=i.prototype,p.addListeners=function(){var e=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(t){e.onTouchBegin(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerMove",function(t){e.onTouchMove(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerUp",function(t){e.onTouchEnd(t),e.prevent(t)},!1)):(t.Capabilities.$isMobile||this.addMouseListener(),this.addTouchListener())},p.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onTouchMove),window.addEventListener("mouseup",this.onTouchEnd)},p.addTouchListener=function(){var t=this;this.canvas.addEventListener("touchstart",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchBegin(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchmove",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchMove(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchend",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchcancel",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1)},p.prevent=function(t){t.stopPropagation(),1==t.isScroll||this.canvas.userTyping||t.preventDefault()},p.getLocation=function(e){e.identifier=+e.identifier||0;var n=document.documentElement,i=this.canvas.getBoundingClientRect(),r=i.left+window.pageXOffset-n.clientLeft,a=i.top+window.pageYOffset-n.clientTop,o=(e.pageX-r)/this.scaleX,s=(e.pageY-a)/this.scaleY;return t.$TempPoint.setTo(Math.round(o),Math.round(s))},p.updateScaleMode=function(t,e){this.scaleX=t,this.scaleY=e},n}(t.LarkObject);e.WebTouchHandler=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(t){return null==o&&(o=i()),o+t.charAt(0).toUpperCase()+t.substr(1)}function i(){for(var t=document.createElement("div").style,e="",n=["t","webkitT","msT","MozT","OT"],i=0;i<n.length;i++){var r=n[i]+"ransform";r in t&&(e=n[i])}return e.substr(0,e.length-1)}var r=new t.Point,a=function(e){function i(n,i,r){var a=this;e.call(this),this.scaleX=1,this.scaleY=1,this.offsetX=1,this.offsetY=1,this.pendingToShowHtmlInput=!1,this.currentTextInput=null,this.singleLineTextInput=null,this.multiLineTextInput=null,this.lastSelectAnchor=0,this.lastSelectActive=0,this.handleContainerClick=function(t){if(a.pendingToShowHtmlInput){a.pendingToShowHtmlInput=!1,t.stopImmediatePropagation(),a.$initializeInput();var e=a.currentHtmlInput;e.onblur=a.handleHtmlInputBlur,e.oninput=a.handleHtmlInputInputEvent,e.focus(),e.onclick=a.getInputSelection,e.onselect=a.getInputSelection,e.onkeydown=a.getInputSelection,a.$selectRange(a.currentTextInput.selectionActivePosition,a.currentTextInput.selectionAnchorPosition),a.getInputSelection(),a.currentTextInput.$startInput()}else null!=a.currentTextInput&&a.$removeCurrentTextInput()},this.handleHtmlInputInputEvent=function(){a.currentTextInput.$setUserInputText(a.currentHtmlInput.value),a.getInputSelection()},this.handleHtmlInputBlur=function(){var t=(a.currentHtmlInput,a.currentTextInput);a.$removeCurrentTextInput(),t.selectRange(a.lastSelectAnchor,a.lastSelectActive)},this.getInputSelection=function(){var t=a.currentHtmlInput.selectionEnd,e=a.currentHtmlInput.selectionStart,n=a.currentHtmlInput.selectionDirection||"forward";a.lastSelectAnchor="forward"==n?e:t,a.lastSelectActive="forward"==n?t:e},this.$stage=i,this.canvas=r,this.container=n,t.sys.$cacheTextAdapter(this),this.createHtmlInputs()}__extends(i,e);var a=i;return p=a.prototype,p.$setCurrentTextInput=function(t){null!=this.currentTextInput&&this.$removeCurrentTextInput(),this.currentTextInput=t,this.currentHtmlInput=t.wordWrap?this.multiLineTextInput:this.singleLineTextInput,t.displayAsPassword&&(this.currentHtmlInput=this.singleLineTextInput),this.currentHtmlInput.value=this.currentTextInput.text,this.pendingToShowHtmlInput=!0,this.canvas.userTyping=!0},p.$removeCurrentTextInput=function(){window.scrollTo(0,0);var t=this.currentTextInput,e=this.currentHtmlInput;e.onblur=null,e.oninput=null,e.onclick=null,e.onselect=null,e.onkeydown=null,this.resetHtmlInputStyle(e),this.resetTextContainerStyle(),t.$setUserInputText(e.value),t.$endInput(),this.currentHtmlInput=null,this.currentTextInput=null,this.pendingToShowHtmlInput=!1,this.canvas.userTyping=!1},p.updateScaleMode=function(t,e,n,i){this.scaleX=t,this.scaleY=e,this.offsetX=n,this.offsetY=i},p.createHtmlInputs=function(){var t=document.createElement("div");this.textContainer=t,t.id="text-container-"+this.hashCode,this.resetTextContainerStyle();var e=document.createElement("input");e.type="text";var n=document.createElement("textarea");n.style.resize="none",this.resetHtmlInputStyle(e),this.resetHtmlInputStyle(n),t.appendChild(e),t.appendChild(n),this.container.appendChild(t),this.singleLineTextInput=e,this.multiLineTextInput=n,this.canvas.addEventListener("click",this.handleContainerClick)},p.resetHtmlElementStyle=function(t){t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.border="none",t.style.padding="2px 0",t.style[n("transformOrigin")]="0% 0% 0px"},p.resetHtmlInputStyle=function(t){t.setAttribute("tabindex","-1"),t.style.width="1px",t.style.height="12px",t.style.outline="thin",t.style.background="none",t.style.overflow="hidden",t.style.wordBreak="break-all",t.style.opacity="0",this.resetHtmlElementStyle(t)},p.resetTextContainerStyle=function(){var t=this.textContainer.style;t.height="0px",t.width="0px",t.top="-100px",this.resetHtmlElementStyle(this.textContainer)},p.$initializeInput=function(){this.singleLineTextInput.style.display="none",this.multiLineTextInput.style.display="none";var e=this.currentTextInput,i=this.currentHtmlInput;i.type=e.displayAsPassword?"password":"text";var a=this.scaleX,o=this.scaleY,s=e.$getConcatenatedMatrix().clone();s.scale(a,o);var l=e.localToGlobal(0,0,r);this.textContainer.style.left=this.offsetX+l.x*a+"px",this.textContainer.style.top=this.offsetY+l.y*o+"px",a=s.$getScaleX(),o=s.$getScaleY();var u=e.width*a+"px",c=e.height*o+"px";this.textContainer.style.width=u,this.textContainer.style.height=c;var h=this.setElementStyle.bind(this);if(h("fontFamily",e.fontFamily),h("fontStyle",e.italic?"italic":"normal"),h("fontWeight",e.bold?"bold":"normal"),h("textAlign",e.textAlign),h("fontSize",e.fontSize+"px"),h("lineHeight",e.fontSize+"px"),h("color",t.sys.toColorString(e.textColor)),h("verticalAlign",e.verticalAlign),h("display","block"),h("width",e.width+"px"),h("height",e.height+"px"),h(n("transform"),"matrix("+[s.a,s.b,s.c,s.d,0,0].join(",")+")"),setTimeout(function(){i.style.opacity="1"},0),0==e.wordWrap&&e.verticalAlign!=t.VerticalAlign.MIDDLE){var p=e.height-e.fontSize+2,d=e.verticalAlign==t.VerticalAlign.TOP?"paddingBottom":"paddingTop";h(d,p+"px"),h("height",e.fontSize+"px")}e.text!=i.value&&(i.value=e.text),0!=e.maxChars?i.maxLength=e.maxChars:i.maxLength>=0&&(i.maxLength=8388608)},p.$selectRange=function(t,e){var n=Math.min(t,e),i=Math.max(t,e);this.currentHtmlInput.setSelectionRange(n,i,e>t?"forward":"backward")},p.setElementStyle=function(t,e){this.currentHtmlInput&&(this.currentHtmlInput.style[t]=e)},i}(t.LarkObject);e.WebTextAdapter=a;var o=null}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(){for(var t=s.length,e=0;t>e;e++){var n=s[e],i=n["lark-player"],r=n["lark-touch"],a=n["lark-screen"],o=n["lark-text-layer"];a.updateScreenSize(i,r,o)}}function i(){var n=t.sys.$ticker=new t.sys.Ticker;a(n);var i=new e.CanvasFactory;t.sys.surfaceFactory=i,t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.ScreenAdapter);for(var o=document.querySelectorAll(".lark-player"),s=o.length,l=0;s>l;l++){var u=o[l];r(u)}}function r(n){s.push(n);var i=n.getAttribute("data-entry-class"),r=+n.getAttribute("data-content-width")||480,a=+n.getAttribute("data-content-height")||800,o=n.getAttribute("data-scale-mode"),l=t.sys.surfaceFactory.create(),u=l,c=new e.WebScreen(n,u,o,r,a),h=new t.Stage,p=new t.sys.TouchHandler(h),d=new e.WebTouchHandler(p,u),v=new e.WebTextAdapter(n,h,u),f=new t.sys.Player(l.renderContext,h,i);n["lark-player"]=f,n["lark-touch"]=d,n["lark-screen"]=c,n["lark-text-layer"]=v,c.updateScreenSize(f,d,v),f.start()}function a(t){function e(){t.update(),n.call(window,e)}var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;n||(n=function(t){return window.setTimeout(t,1e3/60)}),n.call(window,e)}function o(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e}var s=[];e.updateScreenSize=n,t.warn=function(){return console.warn.apply(console,o(arguments))},t.error=function(){return console.error.apply(console,o(arguments))},t.assert=function(){return console.assert.apply(console,o(arguments))},t.log=function(){return console.log.apply(console,o(arguments))},window.addEventListener("load",i),window.addEventListener("resize",n)}(e=t.web||(t.web={}))}(lark||(lark={}));