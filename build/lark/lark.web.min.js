var __extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__define=this.__define||function(t,e,n,i){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:n,set:i})},lark;!function(t){var e;!function(e){var n=window.URL||window.webkitURL,i=n&&"iOS"==t.Capabilities.os,r=function(r){function o(){var n=this;r.apply(this,arguments),this.data=null,this.crossOrigin=null,this.currentImage=null,this.request=null,this.onImageComplete=function(i){var r=n.getImage(i);r&&(n.data=e.toBitmapData(r),n.emitWith(t.Event.COMPLETE))},this.onLoadError=function(e){var i=n.getImage(e);i&&n.emitWith(t.Event.IO_ERROR)}}__extends(o,r);var a=o;return p=a.prototype,p.load=function(e){if(i&&0!=e.indexOf("data:")){var n=this.request;n||(n=this.request=new t.web.WebHttpRequest,n.on(t.Event.COMPLETE,this.onBlobLoaded,this),n.on(t.Event.IO_ERROR,this.onBlobError,this),n.responseType="blob"),n.open(e),n.send()}else this.loadImage(e)},p.onBlobLoaded=function(){var t=this.request.response;this.loadImage(n.createObjectURL(t))},p.onBlobError=function(){this.emitWith(t.Event.IO_ERROR)},p.loadImage=function(t){var e=new Image;this.data=null,this.currentImage=e,this.crossOrigin&&(e.crossOrigin=this.crossOrigin),e.onload=this.onImageComplete,e.onerror=this.onLoadError,e.src=t},p.getImage=function(t){var e=t.target;return i&&n.revokeObjectURL(e.src),e.onerror=null,e.onload=null,this.currentImage!==e?null:(this.currentImage=null,e)},o}(t.EventEmitter);e.WebImageLoader=r,t.registerClass(r,20),t.ImageLoader=r}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(){var n=this;e.call(this),this._url="",this.onReadyStateChange=function(){var e=n._xhr;4==e.readyState&&n.emitWith(e.status>=400||0==e.status?t.Event.IO_ERROR:t.Event.COMPLETE)},this.updateProgress=function(e){e.lengthComputable&&t.ProgressEvent.emitProgressEvent(n,t.ProgressEvent.PROGRESS,e.loaded,e.total)},this._xhr=new XMLHttpRequest,this._xhr.onreadystatechange=this.onReadyStateChange,this._xhr.onprogress=this.updateProgress}__extends(n,e);var i=__define,r=n;return p=r.prototype,i(p,"response",function(){return this._xhr.response?this._xhr.response:this._xhr.responseXML?this._xhr.responseXML:this._xhr.responseText?this._xhr.responseText:null},void 0),i(p,"responseType",function(){return this._xhr.responseType},function(t){this._xhr.responseType=t}),i(p,"withCredentials",function(){return this._xhr.withCredentials},function(t){this._xhr.withCredentials=!!t}),p.open=function(t,e){void 0===e&&(e="GET"),this._url=t,this._xhr.open(e,t,!0)},p.send=function(t){this._xhr.send(t)},p.abort=function(){this._xhr.abort()},p.getAllResponseHeaders=function(){var t=this._xhr.getAllResponseHeaders();return t?t:""},p.setRequestHeader=function(t,e){this._xhr.setRequestHeader(t,e)},p.getResponseHeader=function(t){var e=this._xhr.getResponseHeader(t);return e?e:""},n}(t.EventEmitter);e.WebHttpRequest=n,t.registerClass(n,19),t.HttpRequest=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(){function e(){}var n=e;return p=n.prototype,e.detect=function(){var n=t.Capabilities,i=navigator.userAgent.toLowerCase();n.$isMobile=-1!=i.indexOf("mobile")||-1!=i.indexOf("android"),n.$isMobile?i.indexOf("windows")<0&&(-1!=i.indexOf("iphone")||-1!=i.indexOf("ipad")||-1!=i.indexOf("ipod"))?n.$os="iOS":-1!=i.indexOf("android")&&-1!=i.indexOf("linux")?n.$os="Android":-1!=i.indexOf("windows")&&(n.$os="Windows Phone"):-1!=i.indexOf("windows nt")?n.$os="Windows PC":-1!=i.indexOf("mac os")&&(n.$os="Mac OS");var r=e.checkHtml5Support();n.$hasGeolocation=r.geo,n.$hasMotion=r.m,n.$hasOrientation=r.ortt;var o=(navigator.language||navigator.browserLanguage).toLowerCase(),a=o.split("-");a.length>1&&(a[1]=a[1].toUpperCase()),n.$language=a.join("-")},e.checkHtml5Support=function(){var t=("webkitAudioContext"in window||"AudioContext"in window,"geolocation"in navigator),e="DeviceOrientationEvent"in window,n="DeviceMotionEvent"in window;return{geo:t,ortt:e,m:n}},e}();e.WebCapability=n,n.detect()}(e=t.web||(t.web={}))}(lark||(lark={})),void 0==window.HTMLVideoElement&&(window.HTMLVideoElement=HTMLDivElement);var lark;!function(t){var e;!function(e){function n(e){return e.hashCode=e.$hashCode=t.$hashCount++,e}t.registerClass(HTMLImageElement,7),t.registerClass(HTMLCanvasElement,7),t.registerClass(HTMLVideoElement,7),e.toBitmapData=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(t){for(var e=s.parseFromString(t,"text/xml"),n=e.childNodes.length,r=0;n>r;r++){var o=e.childNodes[r];if(1===o.nodeType)return i(o,null)}return null}function i(t,e){if("parsererror"==t.localName)throw new Error(t.textContent);for(var n=new o(t.localName,e,t.prefix,t.namespaceURI,t.nodeName),r=t.attributes,s=n.attributes,l=r.length,h=0;l>h;h++){var u=r[h],c=u.name;0!==c.indexOf("xmlns:")&&(s[c]=u.value)}var d=t.childNodes;l=d.length;var p=n.children;for(h=0;l>h;h++){var v=d[h],f=v.nodeType,g=null;if(1===f)g=i(v,n);else if(3===f){var m=v.textContent.trim();m&&(g=new a(m,n))}g&&p.push(g)}return n}var r=function(){function t(t,e){this.nodeType=t,this.parent=e}var e=t;return p=e.prototype,t}();e.XMLNode=r;var o=function(t){function e(e,n,i,r,o){t.call(this,1,n),this.attributes={},this.children=[],this.localName=e,this.prefix=i,this.namespace=r,this.name=o}__extends(e,t);var n=e;return p=n.prototype,e}(r);e.XML=o;var a=function(t){function e(e,n){t.call(this,3,n),this.text=e}__extends(e,t);var n=e;return p=n.prototype,e}(r);e.XMLText=a;var s=new DOMParser;t.XML={parse:n}}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=[],i=-1!=navigator.userAgent.indexOf("QQBrowser"),r=function(){function r(){t.sys.sharedRenderContext=this.create().renderContext;for(var e=0;3>e;e++)n.push(this.create())}var o=r;return p=o.prototype,p.create=function(e){var r=e||n.length>3?n.pop():null;if(!r){var o=document.createElement("canvas");if(i&&!this.testCanvasValid(o))return t.warn("failed to create canvas!"),null;r=this.createSurface(o)}return r},p.release=function(t){t&&(t.width=t.height=1,n.push(t))},p.testCanvasValid=function(t){t.height=1,t.width=1;var e=t.toDataURL("image/png");return"data:,"==e?!1:!0},p.createSurface=function(t){var n=t.getContext("2d");t.renderContext=n,n.surface=t,e.toBitmapData(t);var i=n.drawImage;if(n.drawImage=function(t){t&&0!==t.width&&0!==t.height&&i.apply(n,arguments)},void 0===n.imageSmoothingEnabled){for(var r=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],o=r.length-1;o>=0;o--){var a=r[o];if(void 0!==n[a])break}try{Object.defineProperty(n,"imageSmoothingEnabled",{get:function(){return this[a]},set:function(t){this[a]=t}})}catch(s){n.imageSmoothingEnabled=n[a]}}return t},r}();e.CanvasFactory=r}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(t,n,i,r,o,a){e.call(this),this.container=t,this.canvas=n,this.scaleMode=i,this.contentWidth=r,this.contentHeight=o,this.orientation=a,this.attachCanvas(t,n)}__extends(n,e);var i=n;return p=i.prototype,p.attachCanvas=function(t,e){var n=e.style;n.cursor="default",n.position="absolute",n.top="0",n.bottom="0",n.left="0",n.right="0",t.appendChild(e),n=t.style,n.overflow="hidden",n.position="relative"},p.updateScreenSize=function(e,n,i){var r=this.canvas;if(!r.userTyping){var o=this.container.getBoundingClientRect(),a=!1;this.orientation!=t.sys.OrientationMode.NOT_SET&&(a=this.orientation!=t.sys.OrientationMode.PORTRAIT&&o.height>o.width||this.orientation==t.sys.OrientationMode.PORTRAIT&&o.width>o.height);var s=a?o.height:o.width,l=a?o.width:o.height,h=t.sys.screenAdapter.calculateStageSize(this.scaleMode,s,l,this.contentWidth,this.contentHeight),u=h.stageWidth,c=h.stageHeight,d=h.displayWidth,p=h.displayHeight;r.width!==u&&(r.width=u),r.height!==c&&(r.height=c),r.style.width=d+"px",r.style.height=p+"px",r.style.top=(o.height-p)/2+"px",r.style.left=(o.width-d)/2+"px";var v=0;a&&(v=this.orientation==t.sys.OrientationMode.LANDSCAPE?90:-90);var f="rotate("+v+"deg)";r.style.webkitTransform=f,r.style.transform=f,e.updateStageSize(u,c);var g=d/u,m=p/c;n.updateScaleMode(g,m,v),i.updateScaleMode(g,m,(o.width-d)/2,(o.height-p)/2,d/2,p/2,v)}},n}(t.LarkObject);e.WebScreen=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){var n=function(e){function n(t,n){var i=this;e.call(this),this.onTouchBegin=function(t){var e=i.getLocation(t);i.touch.onTouchBegin(e.x,e.y,t.identifier)},this.onTouchMove=function(t){var e=i.getLocation(t);i.touch.onTouchMove(e.x,e.y,t.identifier)},this.onTouchEnd=function(t){var e=i.getLocation(t);i.touch.onTouchEnd(e.x,e.y,t.identifier)},this.scaleX=1,this.scaleY=1,this.rotation=0,this.canvas=n,this.touch=t,this.addListeners()}__extends(n,e);var i=n;return p=i.prototype,p.addListeners=function(){var e=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(t){e.onTouchBegin(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerMove",function(t){e.onTouchMove(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerUp",function(t){e.onTouchEnd(t),e.prevent(t)},!1)):(t.Capabilities.$isMobile||this.addMouseListener(),this.addTouchListener())},p.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onTouchMove),window.addEventListener("mouseup",this.onTouchEnd)},p.addTouchListener=function(){var t=this;this.canvas.addEventListener("touchstart",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchBegin(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchmove",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchMove(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchend",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchcancel",function(e){for(var n=e.changedTouches.length,i=0;n>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1)},p.prevent=function(t){t.stopPropagation(),1==t.isScroll||this.canvas.userTyping||t.preventDefault()},p.getLocation=function(e){e.identifier=+e.identifier||0;var n=document.documentElement,i=this.canvas.getBoundingClientRect(),r=i.left+window.pageXOffset-n.clientLeft,o=i.top+window.pageYOffset-n.clientTop,a=e.pageX-r,s=a,l=e.pageY-o,h=l;return 90==this.rotation?(s=l,h=i.width-a):-90==this.rotation&&(s=i.height-l,h=a),s/=this.scaleX,h/=this.scaleY,t.$TempPoint.setTo(Math.round(s),Math.round(h))},p.updateScaleMode=function(t,e,n){this.scaleX=t,this.scaleY=e,this.rotation=n},n}(t.LarkObject);e.WebTouchHandler=n}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(t){return null==a&&(a=i()),a+t.charAt(0).toUpperCase()+t.substr(1)}function i(){for(var t=document.createElement("div").style,e="",n=["t","webkitT","msT","MozT","OT"],i=0;i<n.length;i++){var r=n[i]+"ransform";r in t&&(e=n[i])}return e.substr(0,e.length-1)}var r=new t.Point,o=function(e){function i(n,i,r){var o=this;e.call(this),this.scaleX=1,this.scaleY=1,this.offsetX=1,this.offsetY=1,this.anchorX=0,this.anchorY=0,this.rotation=0,this.pendingToShowHtmlInput=!1,this.currentTextInput=null,this.singleLineTextInput=null,this.multiLineTextInput=null,this.lastSelectAnchor=0,this.lastSelectActive=0,this.handleContainerClick=function(t){if(o.pendingToShowHtmlInput){o.pendingToShowHtmlInput=!1,t.stopImmediatePropagation(),o.$initializeInput();var e=o.currentHtmlInput;e.onblur=o.handleHtmlInputBlur,e.oninput=o.handleHtmlInputInputEvent,e.focus(),e.onclick=o.getInputSelection,e.onselect=o.getInputSelection,e.onkeydown=o.getInputSelection,o.$selectRange(o.currentTextInput.selectionActivePosition,o.currentTextInput.selectionAnchorPosition),o.getInputSelection(),o.currentTextInput.$startInput()}else null!=o.currentTextInput&&o.$removeCurrentTextInput()},this.handleHtmlInputInputEvent=function(){o.currentTextInput.$setUserInputText(o.currentHtmlInput.value),o.getInputSelection()},this.handleHtmlInputBlur=function(){var t=(o.currentHtmlInput,o.currentTextInput);o.$removeCurrentTextInput(),t.selectRange(o.lastSelectAnchor,o.lastSelectActive)},this.getInputSelection=function(){var t=o.currentHtmlInput.selectionEnd,e=o.currentHtmlInput.selectionStart,n=o.currentHtmlInput.selectionDirection||"forward";o.lastSelectAnchor="forward"==n?e:t,o.lastSelectActive="forward"==n?t:e},this.$stage=i,this.canvas=r,this.container=n,t.sys.$cacheTextAdapter(this),this.createHtmlInputs()}__extends(i,e);var o=i;return p=o.prototype,p.$setCurrentTextInput=function(t){null!=this.currentTextInput&&this.$removeCurrentTextInput(),this.currentTextInput=t,this.currentHtmlInput=t.wordWrap?this.multiLineTextInput:this.singleLineTextInput,t.displayAsPassword&&(this.currentHtmlInput=this.singleLineTextInput),this.currentHtmlInput.value=this.currentTextInput.text,this.pendingToShowHtmlInput=!0,this.canvas.userTyping=!0},p.$removeCurrentTextInput=function(){window.scrollTo(0,0);var t=this.currentTextInput,e=this.currentHtmlInput;e.onblur=null,e.oninput=null,e.onclick=null,e.onselect=null,e.onkeydown=null,this.resetHtmlInputStyle(e),this.resetTextContainerStyle(),t.$setUserInputText(e.value),t.$endInput(),this.currentHtmlInput=null,this.currentTextInput=null,this.pendingToShowHtmlInput=!1,this.canvas.userTyping=!1},p.updateScaleMode=function(t,e,n,i,r,o,a){void 0===a&&(a=0),this.scaleX=t,this.scaleY=e,this.offsetX=n,this.offsetY=i,this.anchorX=r,this.anchorY=o,this.rotation=a},p.createHtmlInputs=function(){var t=document.createElement("div");this.textContainer=t,t.id="text-container-"+this.hashCode,this.resetTextContainerStyle();var e=document.createElement("input");e.type="text";var n=document.createElement("textarea");n.style.resize="none",this.resetHtmlInputStyle(e),this.resetHtmlInputStyle(n),t.appendChild(e),t.appendChild(n),this.container.appendChild(t),this.singleLineTextInput=e,this.multiLineTextInput=n,this.canvas.addEventListener("click",this.handleContainerClick)},p.resetHtmlElementStyle=function(t){t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.border="none",t.style.padding="2px 0",t.style[n("transformOrigin")]="0% 0% 0px"},p.resetHtmlInputStyle=function(t){t.setAttribute("tabindex","-1"),t.style.width="1px",t.style.height="12px",t.style.outline="thin",t.style.background="none",t.style.overflow="hidden",t.style.wordBreak="break-all",t.style.opacity="0",this.resetHtmlElementStyle(t)},p.resetTextContainerStyle=function(){var t=this.textContainer.style;t.height="0px",t.width="0px",t.top="-100px",this.resetHtmlElementStyle(this.textContainer)},p.$initializeInput=function(){this.singleLineTextInput.style.display="none",this.multiLineTextInput.style.display="none";var e=this.currentTextInput,i=this.currentHtmlInput;i.type=e.displayAsPassword?"password":"text";var o=this.scaleX,a=this.scaleY,s=e.$getConcatenatedMatrix().clone();s.scale(o,a);var l=e.localToGlobal(0,0,r),h=this.offsetX+l.x*o,u=this.offsetY+l.y*a;this.textContainer.style.left=h+"px",this.textContainer.style.top=u+"px",o=s.$getScaleX(),a=s.$getScaleY();var c=e.width*o,d=e.height*a;this.textContainer.style.width=c+"px",this.textContainer.style.height=d+"px",this.textContainer.style[n("transformOrigin")]=""+(this.anchorX+this.offsetX-h)+"px "+(this.anchorY+this.offsetY-u)+"px",this.textContainer.style[n("transform")]="rotate("+this.rotation+"deg)";var p=this.setElementStyle.bind(this);if(p("fontFamily",e.fontFamily),p("fontStyle",e.italic?"italic":"normal"),p("fontWeight",e.bold?"bold":"normal"),p("textAlign",e.textAlign),p("fontSize",e.fontSize+"px"),p("lineHeight",e.fontSize+"px"),p("color",t.sys.toColorString(e.textColor)),p("verticalAlign",e.verticalAlign),p("display","block"),p("width",e.width+"px"),p("height",e.height+"px"),p(n("transform"),"matrix("+[s.a,s.b,s.c,s.d,0,0].join(",")+")"),setTimeout(function(){i.style.opacity="1"},0),0==e.wordWrap&&e.verticalAlign!=t.VerticalAlign.MIDDLE){var v=e.height-e.fontSize+2,f=e.verticalAlign==t.VerticalAlign.TOP?"paddingBottom":"paddingTop";p(f,v+"px"),p("height",e.fontSize+"px")}e.text!=i.value&&(i.value=e.text),0!=e.maxChars?i.maxLength=e.maxChars:i.maxLength>=0&&(i.maxLength=8388608)},p.$selectRange=function(t,e){var n=Math.min(t,e),i=Math.max(t,e);this.currentHtmlInput.setSelectionRange(n,i,e>t?"forward":"backward")},p.setElementStyle=function(t,e){this.currentHtmlInput&&(this.currentHtmlInput.style[t]=e)},i}(t.LarkObject);e.WebTextAdapter=o;var a=null}(e=t.web||(t.web={}))}(lark||(lark={}));var lark;!function(t){var e;!function(e){function n(){for(var t=s.length,e=0;t>e;e++){var n=s[e],i=n["lark-player"],r=n["lark-touch"],o=n["lark-screen"],a=n["lark-text-layer"];o.updateScreenSize(i,r,a)}}function i(){var n=t.sys.$ticker=new t.sys.Ticker;o(n);var i=new e.CanvasFactory;t.sys.surfaceFactory=i,t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.ScreenAdapter);for(var a=document.querySelectorAll(".lark-player"),s=a.length,l=0;s>l;l++){var h=a[l];r(h)}}function r(n){s.push(n);var i=n.getAttribute("data-entry-class"),r=+n.getAttribute("data-content-width")||480,o=+n.getAttribute("data-content-height")||800,a=n.getAttribute("data-scale-mode"),l=n.getAttribute("data-orientation")||t.sys.OrientationMode.NOT_SET,h=t.sys.surfaceFactory.create(),u=h,c=new e.WebScreen(n,u,a,r,o,l),d=new t.Stage,p=new t.sys.TouchHandler(d),v=new e.WebTouchHandler(p,u),f=new e.WebTextAdapter(n,d,u),g=new t.sys.Player(h.renderContext,d,i);n["lark-player"]=g,n["lark-touch"]=v,n["lark-screen"]=c,n["lark-text-layer"]=f,c.updateScreenSize(g,v,f),g.start()}function o(t){function e(){t.update(),n.call(window,e)}var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;n||(n=function(t){return window.setTimeout(t,1e3/60)}),n.call(window,e)}function a(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e}var s=[];e.updateScreenSize=n,t.warn=function(){console.warn.apply(console,a(arguments))},t.error=function(){console.error.apply(console,a(arguments))},t.assert=function(){console.assert.apply(console,a(arguments))},t.log=function(){console.log.apply(console,a(arguments))},window.addEventListener("load",i),window.addEventListener("resize",n)}(e=t.web||(t.web={}))}(lark||(lark={}));